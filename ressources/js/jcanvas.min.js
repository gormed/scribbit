/*
 jCanvas v13.05.06
 Copyright 2013 Caleb Evans
 Released under the MIT license
*/
(function(d,Ca,na,W,oa,w,G,f,y){function I(e){S(this,e);return this}function O(e){e?S(I.prototype,e):O.prefs=I.prototype=S({},da);return this}function Y(e){return"string"===Z(e)}function F(e){return e&&e.getContext?e.getContext("2d"):f}function Q(e,b){e.fillStyle=b.fillStyle;e.strokeStyle=b.strokeStyle;e.lineWidth=b.strokeWidth;b.rounded?(e.lineCap="round",e.lineJoin="round"):(e.lineCap=b.strokeCap,e.lineJoin=b.strokeJoin,e.miterLimit=b.miterLimit);e.shadowOffsetX=b.shadowX;e.shadowOffsetY=b.shadowY;
e.shadowBlur=b.shadowBlur;e.shadowColor=b.shadowColor;e.globalAlpha=b.opacity;e.globalCompositeOperation=b.compositing;b.imageSmoothing&&(e.webkitimageSmoothingEnabled=e.mozimageSmoothingEnabled=b.imageSmoothing)}function pa(e,b,a){a.mask&&(a.autosave&&(e.save(),b.savedTransforms=S({},b.transforms),b.transforms.masks+=1,b.transforms.withinMask=e.isPointInPath(b.event.x,b.event.y)?w:G),e.clip())}function ha(e,b,a){a.layer&&(a._args.withinMask=b.transforms.withinMask===w||b.transforms.withinMask===
f?w:G)}function T(e,b,a){a.closed&&b.closePath();b.fill();"transparent"!==a.fillStyle&&(b.shadowColor="transparent");0!==a.strokeWidth&&b.stroke();a.closed||b.closePath();a._transformed&&b.restore();if(a.mask||a.layer)e=K(e),pa(b,e,a),ha(b,e,a)}function qa(e,b,a){b._toRad=b.inDegrees?M/180:1;e.translate(b.x,b.y);e.rotate(b.rotate*b._toRad);e.translate(-b.x,-b.y);a.rotate+=b.rotate*b._toRad}function ra(e,b,a){1!==b.scale&&(b.scaleX=b.scaleY=b.scale);e.translate(b.x,b.y);e.scale(b.scaleX,b.scaleY);
e.translate(-b.x,-b.y);a.scaleX*=b.scaleX;a.scaleY*=b.scaleY}function sa(e,b,a){b.translate&&(b.translateX=b.translateY=b.translate);e.translate(b.translateX,b.translateY);a.translateX+=b.translateX;a.translateY+=b.translateY}function P(e,b,a,c){b._toRad=b.inDegrees?M/180:1;b._transformed=w;e.save();c===y&&(c=a);!b.fromCenter&&!b._centered&&(b.x+=a/2,b.y+=c/2,b._centered=w);b.rotate&&qa(e,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&ra(e,b,{});(b.translate||b.translateX||b.translateY)&&sa(e,b,
{})}function K(e){var b;L._canvas===e&&L._data?b=L._data:(b=d.data(e,"jCanvas"),b||(b={canvas:e,layers:[],layer:{names:{},groups:{}},intersects:[],drag:{},event:{},events:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:0,withinMask:f},animating:G,animated:f},b.savedTransforms=S({},b.transforms),d.data(e,"jCanvas",b)),L._canvas=e,L._data=b);return b}function ta(e,b,a){for(var c in O.events)if(O.events.hasOwnProperty(c)){var h=e,g=b,j=a,d=c;j[d]&&(d=ia(d),O.events[d](h,g),
j._event=w)}}function ua(e,b,a){var c,h,g;if(a.draggable||a.dragGroupWithLayer||a.cursor){c=["mousedown","mousemove","mouseup"];for(g=0;g<c.length;g+=1)h=ia(c[g]),O.events[h](e,b);b.events.mouseoutdrag||(e.bind("mouseout.jCanvas",function(){var a=b.drag.layer;a&&(b.drag={},e.drawLayers(),a.dragcancel&&a.dragcancel.call(e[0],a))}),b.events.mouseoutdrag=w);a._event=w}}function ea(e,b,a,c){e=b.layer.names;c?c.name!==y&&(Y(a.name)&&a.group!==c.group)&&delete e[a.name]:c=a;Y(c.name)&&(e[c.name]=a)}function ja(e,
b,a,c){e=b.layer.groups;var h,g;if(c){if(c.group!==y&&(Y(a.group)&&a.group!==c.group)&&(b=e[a.group])){for(g=0;g<b.length;g+=1)if(b[g]===a){h=g;b.splice(g,1);break}0===b.length&&delete e[a.group]}}else c=a;Y(c.group)&&(b=e[c.group],b||(b=e[c.group]=[],b.name=c.group),h===y&&(h=b.length),b.splice(h,0,a))}function N(e,b,a,c){var h=a;b._args=a;b.canvas=e;b.draggable&&(b.layer=w,b.draggable=w);b._method=c?c:b.method?d.fn[b.method]:b.type?d.fn[va[b.type]]:function(){};b.layer&&!b._layer&&(a=d(e),c=a.getLayers(),
e=K(e),h=new I(b),ea(a,e,h),ja(a,e,h),ta(a,e,h),ua(a,e,h),h.layer=w,h._layer=w,h.index===y&&(h.index=c.length),c.splice(h.index,0,h));return h}function wa(e){var b;for(b=0;b<V.length;b+=1)e[V[b]]=e["_"+V[b]]}function xa(e,b){var a;for(a=0;a<V.length;a+=1)e["_"+V[a]]=e[V[a]],ka[V[a]]=1,b&&delete e[V[a]]}function ya(e){var b,a,c=[],h=1;e.match(/^#?\w+$/i)&&("transparent"===e&&(e="rgba(0,0,0,0)"),a=Ca.head,b=a.style.color,a.style.color=e,e=d.css(a,"color"),a.style.color=b);e.match(/^rgb/i)&&(c=e.match(/\d+/gi),
e.match(/%/gi)&&(h=2.55),c[0]*=h,c[1]*=h,c[2]*=h,c[3]=c[3]!==y?oa(c[3]):1);return c}function Da(e){var b=3,a;"array"!==Z(e.start)&&(e.start=ya(e.start),e.end=ya(e.end));e.now=[];if(1!==e.start[3]||1!==e.end[3])b=4;for(a=0;a<b;a+=1)e.now[a]=e.start[a]+(e.end[a]-e.start[a])*e.pos,3>a&&(e.now[a]=Ea(e.now[a]));1!==e.start[3]||1!==e.end[3]?e.now="rgba("+e.now.join(",")+")":(e.now.slice(0,3),e.now="rgb("+e.now.join(",")+")");e.elem.nodeName?e.elem.style[e.prop]=e.now:e.elem[e.prop]=e.now}function ia(e){"ontouchstart"in
window&&la[e]&&(e=la[e]);return e}function U(e){O.events[e]=function(b,a){e=ia(e);var c="mouseover"===e||"mouseout"===e?"mousemove":e,h=a.event;a.events[c]||(b.bind(c+".jCanvas",function(a){h.x=a.offsetX;h.y=a.offsetY;h.type=c;h.event=a;b.drawLayers({resetFire:w});a.preventDefault()}),a.events[c]=w)}}function R(e,b,a){var c,h,g,j;a=a._args;a._event&&(e=K(e),c=e.event,b=b.isPointInPath(c.x,c.y),h=e.transforms,a.eventX=a.mouseX=c.x,a.eventY=a.mouseY=c.y,a.event=c.event,j=e.transforms.rotate,c=a.eventX,
g=a.eventY,0!==j?(a._eventX=c*X(-j)-g*$(-j),a._eventY=g*X(-j)+c*$(-j)):(a._eventX=c,a._eventY=g),a._eventX/=h.scaleX,a._eventY/=h.scaleY,!b&&(a._hovered&&!a._fired)&&(a._mousedout=w),b&&e.intersects.push(a))}function fa(e,b,a,c,h){b.save();b.beginPath();b.rect(c[0],h[0],c[1]-c[0],h[1]-h[0]);b.clip();P(b,a,0);b.beginPath()}function ga(e,b,a){a._event&&R(e,b,a);b.restore();T(e,b,a)}function za(e,b){b.font?e.font=b.font:(isNaN(Number(b.fontSize))||(b.fontSize+="px"),e.font=b.fontStyle+" "+b.fontSize+
" "+b.fontFamily)}function Aa(e,b){var a=b.text,c=b.maxWidth,h=a.split(" "),g=[],j="";if(e.measureText(a).width<c||1===h.length)g=[a];else{for(a=0;a<h.length;a+=1)e.measureText(j+h[a]).width>c&&(""!==j&&g.push(j),j=""),j+=h[a],a!==h.length-1&&(j+=" ");g.push(j)}return g=g.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}var da,S=d.extend,aa=d.inArray,Z=d.type,ba=d.isFunction,Ea=W.round,M=W.PI,$=W.sin,X=W.cos,Fa=d.event.fix,la,ma,va,L={},V,ka;d.fn.jCanvas=O;O.events={};da={align:"center",autosave:w,
baseline:"middle",bringToFront:G,ccw:G,closed:G,compositing:"source-over",concavity:0,cornerRadius:0,cropFromCenter:w,disableDrag:G,disableEvents:G,domain:f,draggable:G,group:f,data:{},each:f,end:360,fillStyle:"transparent",font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:w,fn:f,graph:"y",height:f,imageSmoothing:w,inDegrees:w,lineHeight:1,layer:G,load:f,mask:G,maxWidth:f,miterLimit:10,name:f,opacity:1,projection:0,r1:f,r2:f,radius:0,range:f,repeat:"repeat",respectAlign:G,
rotate:0,rounded:G,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:f,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,type:f,visible:w,width:f,x:0,y:0};O();O.extend=function(e){O.defaults=S(da,e.props);O();e.name&&(d.fn[e.name]=function a(c){var h,g,j,d=new I(c);for(g=0;g<this.length;g+=1)if(h=this[g],j=F(h))c=N(h,d,c,a),Q(j,d),e.fn.call(h,
j,d);return this});return d.fn[e.name]};d.fn.getLayers=function(e){var b=this[0],a,c,h=[];if(b&&b.getContext)if(a=K(b).layers,ba(e))for(c=0;c<a.length;c+=1)e.call(b,a[c])&&h.push(a[c]);else h=a;return h};d.fn.getLayer=function(e){var b=this.getLayers(),a=d.type(e),c=K(this[0]),h;if(e&&e.layer)h=e;else if("number"===a)0>e&&(e=b.length+e),h=b[e];else if("regexp"===a)for(a=0;a<b.length;a+=1){if(Y(b[a].name)&&b[a].name.match(e)){h=b[a];break}}else c=K(this[0]),h=c.layer.names[e];return h};d.fn.getLayerGroup=
function(e){var b=d.type(e),a,c;if("array"===b)return e;if("regexp"===b)for(a in b=K(this[0]),b=b.groups,b){if(a.match(e)){c=b[a];break}}else b=K(this[0]),c=b.layer.groups[e];return c};d.fn.getLayerIndex=function(e){var b=this.getLayers();e=this.getLayer(e);return aa(e,b)};d.fn.setLayer=function(e,b){var a,c,h,g;for(c=0;c<this.length;c+=1)if(a=d(this[c]),h=K(this[c]),g=d(this[c]).getLayer(e))ea(a,h,g,b),ja(a,h,g,b),S(g,b),ta(a,h,g),ua(a,h,g);return this};d.fn.setLayerGroup=function(e,b){var a,c,h,
g;for(c=0;c<this.length;c+=1)if(a=d(this[c]),h=a.getLayerGroup(e))for(g=0;g<h.length;g+=1)a.setLayer(h[g],b);return this};d.fn.setLayers=function(e){var b,a,c,h;for(a=0;a<this.length;a+=1){b=d(this[a]);c=d(this[a]).getLayers();for(h=0;h<c.length;h+=1)b.setLayer(c[h],e)}return this};d.fn.moveLayer=function(e,b){var a,c,h;for(c=0;c<this.length;c+=1)if(a=d(this[c]),h=a.getLayers(),a=a.getLayer(e))a.index=aa(a,h),h.splice(a.index,1),h.splice(b,0,a),0>b&&(b=h.length+b),a.index=b;return this};d.fn.removeLayer=
function(e){var b,a,c,h,g;for(a=0;a<this.length;a+=1)if(b=d(this[a]),c=K(this[a]),h=b.getLayers(),g=b.getLayer(e))g.index=aa(g,h),h.splice(g.index,1),ea(b,c,g,{name:f}),ja(b,c,g,{group:f});return this};d.fn.removeLayerGroup=function(e){var b,a,c;d.type(e);var h,g,j,E;if(e!==y)for(a=0;a<this.length;a+=1)if(b=d(this[a]),c=K(this[a]),h=b.getLayers(),g=b.getLayerGroup(e)){for(E=0;E<g.length;E+=1)j=g[E],j.index=aa(j,h),h.splice(j.index,1),ea(b,c,j,{name:f});delete c.layer.groups[g.name]}return this};d.fn.removeLayers=
function(){var e,b;for(e=0;e<this.length;e+=1)d(this[e]),b=K(this[e]),b.layers.length=0,b.layer.names={},b.layer.groups={};return this};d.fn.drawLayer=function b(a){var c,h,g,j;for(c=0;c<this.length;c+=1)g=d(this[c]),h=F(this[c]),j=g.getLayer(a),b(g,h,j);return this};d.fn.drawLayers=function(b){var a,c,h=b||{},g,j,E,J,r,C;h.index||(h.index=0);for(b=0;b<this.length;b+=1)if(a=d(this[b]),c=F(this[b])){E=K(this[b]);for(g=0;g<E.transforms.masks;g+=1)a.restoreCanvas();h.clear!==G&&a.clearCanvas();c=E.layers;
for(j=h.index;j<c.length&&!(g=c[j],g.index=j,h.resetFire&&(g._fired=G),g._event=!g.disableEvents,J=a,r=g,C=j+1,r&&(r.visible&&r._method)&&(r._next=C?C:f,r._method.call(J,r)),g._mousedout&&(g._mousedout=G,g._fired=w,g._hovered=G,g.mouseout&&g.mouseout.call(this[b],g),g.cursor&&g._cursor&&a.css({cursor:g._cursor})),g._method===d.fn.drawImage&&g.visible);j+=1);for(g=0;g<E.transforms.masks;g+=1)a.restoreCanvas();g=E.intersects[E.intersects.length-1]||[];j=E.event;J=j.type;g[J]||ma[J]&&(J=ma[J]);C=g[J];
r=E.drag;if(g._event&&g.withinMask===w){if((g.mouseover||g.mouseout||g.cursor)&&!g._hovered&&!g._fired)g._fired=w,g._hovered=w,g.mouseover&&g.mouseover.call(this[b],g),g.cursor&&(g._cursor=a.css("cursor"),a.css({cursor:g.cursor}));C&&!g._fired&&(g._fired=w,C.call(this[b],g),j.type=f);if(g.draggable&&!g.disableDrag&&("mousedown"===J||"touchstart"===J)){g.bringToFront&&(c.splice(g.index,1),g.index=c.push(g));r.layer=g;r.dragging=w;if(r.layer.group&&r.layer.dragGroupWithLayer&&(a=E.layer.groups[r.layer.group]))for(j=
0;j<a.length;j+=1)a[j]!==r.layer&&(a[j]._startX=a[j].x,a[j]._startY=a[j].y,a[j]._endX=g._eventX,a[j]._endY=g._eventY,a[j].bringToFront&&(a[j].index=aa(a[j],c),c.splice(a[j].index,1),c.splice(-1,0,a[j]),a[j].index=c.length-2));r._startX=g._startX=g.x;r._startY=g._startY=g.y;r._endX=g._endX=g._eventX;r._endY=g._endY=g._eventY;g.dragstart&&g.dragstart.call(this[b],g)}}if(r.layer){if(r.dragging&&("mouseup"===J||"touchend"===J))r.layer.dragstop&&r.layer.dragstop.call(this[b],r.layer),E.drag={};if(r.dragging&&
("mousemove"===J||"touchmove"===J))if(r.layer.x=r.layer._eventX-(r._endX-r._startX),r.layer.y=r.layer._eventY-(r._endY-r._startY),r.layer.drag&&r.layer.drag.call(this[b],r.layer),r.layer.group&&r.layer.dragGroupWithLayer&&(a=E.layer.groups[r.layer.group]))for(j=0;j<a.length;j+=1)a[j]!==r.layer&&(a[j].x=r.layer._eventX-(a[j]._endX-a[j]._startX),a[j].y=r.layer._eventY-(a[j]._endY-a[j]._startY))}E.intersects=[]}return this};d.fn.addLayer=function(b){var a,c,h;h=new I(b);for(a=0;a<this.length;a+=1)if(c=
F(this[a]))h.layer=w,b=N(this[a],h,b);return this};V=["width","height","opacity","lineHeight"];ka={};d.fn.animateLayer=function(){function b(a,b,c){return function(){wa(c);(!b.animating||b.animated===c)&&a.drawLayers();j[4]&&j[4].call(a[0],c);c._animating=G;b.animating=G;b.animated=f}}function a(a,b,c){return function(g,h){wa(c);!c._animating&&!b.animating&&(c._animating=w,b.animating=w,b.animated=c);(!b.animating||b.animated===c)&&a.drawLayers();j[5]&&j[5].call(a[0],g,h,c)}}var c,h,g,j=[].slice.call(arguments,
0),E,J;"object"===Z(j[0])&&!j[0].layer&&j.unshift(0);"object"===Z(j[2])?(j.splice(2,0,j[2].duration||f),j.splice(3,0,j[3].easing||f),j.splice(4,0,j[4].complete||f),j.splice(5,0,j[5].step||f)):(j[2]===y?(j.splice(2,0,f),j.splice(3,0,f),j.splice(4,0,f)):ba(j[2])&&(j.splice(2,0,f),j.splice(3,0,f)),j[3]===y?(j[3]=f,j.splice(4,0,f)):ba(j[3])&&j.splice(3,0,f));for(h=0;h<this.length;h+=1)if(c=d(this[h]),g=F(this[h]))if(g=K(this[h]),(E=c.getLayer(j[0]))&&E._method!==d.fn.draw){J=S({},j[1]);var r=this[h],
C=E,z=void 0;for(z in J)J.hasOwnProperty(z)&&ba(J[z])&&(J[z]=J[z].call(r,C,z));xa(J,w);xa(E);E.style=ka;d(E).animate(J,{duration:j[2],easing:d.easing[j[3]]?j[3]:f,complete:b(c,g,E),step:a(c,g,E)})}return this};d.fn.animateLayerGroup=function(b){var a,c,h=[].slice.call(arguments,0),g,j;for(c=0;c<this.length;c+=1){a=d(this[c]);g=a.getLayerGroup(b);for(j=0;j<g.length;j+=1)a.animateLayer.apply(a,[g[j]].concat(h.slice(1)))}return this};d.fn.delayLayer=function(b,a){var c,h;a=a||0;for(c=0;c<this.length;c+=
1)h=d(this[c]).getLayer(b),d(h).delay(a);return this};d.fn.delayLayerGroup=function(b,a){var c,h,g,j;a=a||0;for(h=0;h<this.length;h+=1)if(c=d(this[h]),c=c.getLayerGroup(b))for(j=0;j<c.length;j+=1)(g=c[j])&&d(g).delay(a);return this};d.fn.stopLayer=function(b,a){var c,h;for(c=0;c<this.length;c+=1)(h=d(this[c]).getLayer(b))&&d(h).stop(a);return this};d.fn.stopLayerGroup=function(b,a){var c,h,g,j;for(h=0;h<this.length;h+=1)if(c=d(this[h]),c=c.getLayerGroup(b))for(j=0;j<c.length;j+=1)(g=c[j])&&d(g).stop(a);
return this};var Ba="color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "),ca;for(ca=0;ca<Ba.length;ca+=1)d.fx.step[Ba[ca]]=Da;la={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};ma={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};U("click");U("dblclick");U("mousedown");U("mouseup");U("mousemove");U("mouseover");U("mouseout");U("touchstart");U("touchmove");U("touchend");
d.event.fix=function(b){var a,c;b=Fa.call(d.event,b);if(a=b.originalEvent)if(c=a.changedTouches,b.pageX!==y&&b.offsetX===y){if(a=d(b.target).offset())b.offsetX=b.pageX-a.left,b.offsetY=b.pageY-a.top}else if(c&&(a=d(a.target).offset()))b.offsetX=c[0].pageX-a.left,b.offsetY=c[0].pageY-a.top;return b};va={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",
vector:"drawVector"};d.fn.draw=function a(c){var h,g,j,f;f=new I(c);for(g=0;g<this.length;g+=1)if(h=d(this[g]),j=F(this[g]))c=N(this[g],f,c),f.visible&&(f.fn?f.fn.call(this[g],j,f):f._method!==a&&f._method.call(h,c));return this};d.fn.clearCanvas=function(a){var c,h=new I(a);for(a=0;a<this.length;a+=1)if(c=F(this[a]))!h.x||!h.y||!h.width||!h.height?(c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,this[a].width,this[a].height)):(P(c,h,h.width,h.height),c.clearRect(h.x-h.width/2,h.y-h.height/2,
h.width,h.height)),c.restore();return this};d.fn.saveCanvas=function(){var a,c,h;for(a=0;a<this.length;a+=1)if(c=F(this[a]))h=K(this[a]),c.save(),h.savedTransforms=S({},h.transforms);return this};d.fn.restoreCanvas=function(){var a,c,h;for(a=0;a<this.length;a+=1)if(c=F(this[a]))h=K(this[a]),c.restore(),h.transforms=S({},h.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=function(a){var c={layer:w,fn:function(){d(this).restoreCanvas()}};S(c,a);return this.draw(c)};d.fn.rotateCanvas=function c(h){var g,
j,d=new I(h),f;for(g=0;g<this.length;g+=1)if(j=F(this[g]))f=K(this[g]),h=N(this[g],d,h,c),d.autosave&&j.save(),qa(j,d,f.transforms);return this};d.fn.scaleCanvas=function h(g){var j,d,f=new I(g),r;for(j=0;j<this.length;j+=1)if(d=F(this[j]))r=K(this[j]),g=N(this[j],f,g,h),f.autosave&&d.save(),ra(d,f,r.transforms);return this};d.fn.translateCanvas=function g(j){var d,f,r=new I(j),C;for(d=0;d<this.length;d+=1)if(f=F(this[d]))C=K(this[d]),j=N(this[d],r,j,g),r.autosave&&f.save(),sa(f,r,C.transforms);return this};
d.fn.drawRect=function j(d){var f,r,C=new I(d),z,B,A,D,v;for(f=0;f<this.length;f+=1)if(r=F(this[f]))d=N(this[f],C,d,j),C.visible&&(Q(r,C),P(r,C,C.width,C.height),r.beginPath(),z=C.x-C.width/2,B=C.y-C.height/2,(v=C.cornerRadius)?(C.closed=w,A=C.x+C.width/2,D=C.y+C.height/2,0>A-z-2*v&&(v=(A-z)/2),0>D-B-2*v&&(v=(D-B)/2),r.moveTo(z+v,B),r.lineTo(A-v,B),r.arc(A-v,B+v,v,3*M/2,2*M,G),r.lineTo(A,D-v),r.arc(A-v,D-v,v,0,M/2,G),r.lineTo(z+v,D),r.arc(z+v,D-v,v,M/2,M,G),r.lineTo(z,B+v),r.arc(z+v,B+v,v,M,3*M/2,
G)):r.rect(z,B,C.width,C.height),C._event&&R(this[f],r,C),T(this[f],r,C));return this};d.fn.drawArc=function E(d){var f,C,z=new I(d);d=d||{};z.layer&&(!z.inDegrees&&360===z.end)&&(d.end=z.end=2*M);for(f=0;f<this.length;f+=1)if(C=F(this[f]))d=N(this[f],z,d,E),z.visible&&(Q(C,z),P(C,z,2*z.radius),C.beginPath(),C.arc(z.x,z.y,z.radius,z.start*z._toRad-M/2,z.end*z._toRad-M/2,z.ccw),z._event&&R(this[f],C,z),T(this[f],C,z));return this};d.fn.drawEllipse=function J(d){var f,z,B=new I(d),A=4*B.width/3,D=B.height;
B.closed=w;for(f=0;f<this.length;f+=1)if(z=F(this[f]))d=N(this[f],B,d,J),B.visible&&(Q(z,B),P(z,B,B.width,B.height),z.beginPath(),z.moveTo(B.x,B.y-D/2),z.bezierCurveTo(B.x-A/2,B.y-D/2,B.x-A/2,B.y+D/2,B.x,B.y+D/2),z.bezierCurveTo(B.x+A/2,B.y+D/2,B.x+A/2,B.y-D/2,B.x,B.y-D/2),B._event&&R(this[f],z,B),T(this[f],z,B));return this};d.fn.drawPolygon=function r(d){var f,B,A=new I(d),D=2*M/A.sides,v=M/A.sides,q=v+M/2,p=A.radius*X(D/2),m,k,s;A.closed=w;A.projection&&(A.concavity=-A.projection);for(f=0;f<this.length;f+=
1)if(B=F(this[f]))if(d=N(this[f],A,d,r),A.visible){Q(B,A);P(B,A,2*A.radius);B.beginPath();for(s=0;s<A.sides;s+=1)m=A.x+A.radius*X(q),k=A.y+A.radius*$(q),B.lineTo(m,k),A.concavity&&(m=A.x+(p+-p*A.concavity)*X(q+v),k=A.y+(p+-p*A.concavity)*$(q+v),B.lineTo(m,k)),q+=D;A._event&&R(this[f],B,A);T(this[f],B,A)}return this};d.fn.drawLine=function C(d){var f,A,D=new I(d),v,q,p;for(f=0;f<this.length;f+=1)if(A=F(this[f]))if(d=N(this[f],D,d,C),D.visible){Q(A,D);P(A,D,0);v=1;for(A.beginPath();w;)if(q=D["x"+v],
p=D["y"+v],q!==y&&p!==y)A.lineTo(q+D.x,p+D.y),v+=1;else break;D._event&&R(this[f],A,D);T(this[f],A,D)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function z(d){var f,D,v=new I(d),q,p,m,k,s;for(f=0;f<this.length;f+=1)if(D=F(this[f]))if(d=N(this[f],v,d,z),v.visible){Q(D,v);P(D,v,0);q=2;D.beginPath();for(D.moveTo(v.x1+v.x,v.y1+v.y);w;)if(p=v["x"+q],m=v["y"+q],k=v["cx"+(q-1)],s=v["cy"+(q-1)],p!==y&&m!==y&&k!==y&&s!==y)D.quadraticCurveTo(k+v.x,s+v.y,p+v.x,m+v.y),q+=1;else break;v._event&&R(this[f],D,
v);T(this[f],D,v)}return this};d.fn.drawBezier=function B(d){var f,v,q=new I(d),p,m,k,s,t,u,n,x;for(f=0;f<this.length;f+=1)if(v=F(this[f]))if(d=N(this[f],q,d,B),q.visible){Q(v,q);P(v,q,0);p=2;m=1;v.beginPath();for(v.moveTo(q.x1+q.x,q.y1+q.y);w;)if(k=q["x"+p],s=q["y"+p],t=q["cx"+m],u=q["cy"+m],n=q["cx"+(m+1)],x=q["cy"+(m+1)],k!==y&&s!==y&&t!==y&&u!==y&&n!==y&&x!==y)v.bezierCurveTo(t+q.x,u+q.y,n+q.x,x+q.y,k+q.x,s+q.y),p+=1,m+=2;else break;q._event&&R(this[f],v,q);T(this[f],v,q)}return this};d.fn.drawVector=
function A(d){var f,q,p=new I(d),m,k,s,t,u;for(f=0;f<this.length;f+=1)if(q=F(this[f]))if(d=N(this[f],p,d,A),p.visible){Q(q,p);P(q,p,0);m=1;q.beginPath();t=p.x;u=p.y;for(q.moveTo(p.x,p.y);w;)if(k=p["a"+m],s=p["l"+m],k!==y&&s!==y)k=k*p._toRad-M/2,t+=s*W.cos(k),u+=s*W.sin(k),q.lineTo(t,u),m+=1;else break;p._event&&R(this[f],q,p);T(this[f],q,p)}return this};d.fn.drawGraph=function D(d){var q,p,m=new I(d),k,s,t,u,n,x;for(q=0;q<this.length;q+=1)if((p=F(this[q]))&&m.fn)if(d=N(this[q],m,d,D),m.visible){Q(p,
m);k=m.graph;s=m.domain;t=m.range;u=this[q].width;n=this[q].height;s===f&&(s=[f,f]);s[0]===f&&(s[0]=0);s[1]===f&&(s[1]=u);t===f&&(t=[f,f]);t[0]===f&&(t[0]=0);t[1]===f&&(t[1]=n);fa(q,p,m,s,t);if("y"===k)for(k=s[0]-m.x;k<=s[1]-m.x;k+=1)u=m.fn(k,m),u===f?(ga(this[q],p,m),fa(q,p,m,s,t)):p.lineTo(k+m.x,u+m.y);else if("x"===k)for(u=t[0]-m.y;u<=t[1]-m.y;u+=1)k=m.fn(u,m),k===f?(ga(this[q],p,m),fa(q,p,m,s,t)):p.lineTo(k+m.x,u+m.y);else if("r"===k)for(x=0;x<2*M;x+=M/180)n=m.fn(x,m),k=n*X(x),u=n*$(x),n===f?
(ga(this[q],p,m),fa(p,m,s,t)):p.lineTo(k+m.x,u+m.y);ga(this[q],p,m)}return this};d.fn.drawText=function v(q){var p,m,k=new I(q),s,t,u,n;for(p=0;p<this.length;p+=1)if(d(this[p]),m=F(this[p]))if(q=N(this[p],k,q,v),k.visible){Q(m,k);m.textBaseline=k.baseline;m.textAlign=k.align;za(m,k);!p&&k.maxWidth!==f?s=Aa(m,k):p||(s=String(k.text).split("\n"));if(!p){t=this[p];n=m;var x=k,l=s,H=void 0,w=void 0,y=/\b(\d*\.?\d*)\w\w\b/gi,w=H=void 0;if(L.text===x.text&&L.font===x.font&&L.fontStyle===x.fontStyle&&L.fontSize===
x.fontSize&&L.fontFamily===x.fontFamily&&L.maxWidth===x.maxWidth&&L.lineHeight===x.lineHeight)x.width=L.width,x.height=L.height;else{x.width=n.measureText(l[0]).width;for(H=1;H<l.length;H+=1)w=n.measureText(l[H]).width,w>x.width&&(x.width=w);H=t.style.fontSize;if(x.font){if(w=x.font.match(y))t.style.fontSize=x.font.match(y)[0]}else t.style.fontSize=x.fontSize;x.height=oa(d.css(t,"fontSize"))*l.length*x.lineHeight;t.style.fontSize=H}}P(m,k,k.width,k.height);p||(u=k.x,"left"===k.align&&!k.respectAlign?
u-=k.width/2:"right"===k.align&&!k.respectAlign&&(u+=k.width/2));for(t=0;t<s.length;t+=1)m.shadowColor=k.shadowColor,n=k.y+t*k.height/s.length-(s.length-1)*k.height/s.length/2,m.fillText(s[t],u,n),"transparent"!==k.fillStyle&&(m.shadowColor="transparent"),m.strokeText(s[t],u,n);k._event?(m.beginPath(),m.rect(k.x-k.width/2,k.y-k.height/2,k.width,k.height),m.restore(),R(this[p],m,k),m.closePath(),ha(m,K(this[p]),k)):m.restore()}L=k;return this};d.fn.measureText=function q(d){var f,k;f=d!==y&&("object"!==
Z(d)||d.layer)?this.getLayer(d):new I(d);if(d=F(this[0]))za(d,f),k=Aa(d,f),q(this[0],d,f,k);return f};d.fn.drawImage=function p(m){function k(k,p,n){return function(){0===p&&(l.width===f&&l.sWidth===f&&(l.width=l.sWidth=H.width),l.height===f&&l.sHeight===f&&(l.height=l.sHeight=H.height),m&&l.layer&&(m.width=l.width,m.height=l.height),Q(n,l),l.sWidth!==f&&l.sHeight!==f&&l.sx!==f&&l.sy!==f?(l.width===f&&(l.width=l.sWidth),l.height===f&&(l.height=l.sHeight),l.cropFromCenter||(l.sx+=l.sWidth/2,l.sy+=
l.sHeight/2),l.sx+l.sWidth/2>H.width&&(l.sx=H.width-l.sWidth/2),0>l.sx-l.sWidth/2&&(l.sx=l.sWidth/2),0>l.sy-l.sHeight/2&&(l.sy=l.sHeight/2),l.sy+l.sHeight/2>H.height&&(l.sy=H.height-l.sHeight/2),P(n,l,l.width,l.height),n.drawImage(H,l.sx-l.sWidth/2,l.sy-l.sHeight/2,l.sWidth,l.sHeight,l.x-l.width/2,l.y-l.height/2,l.width,l.height)):(P(n,l,l.width,l.height),n.drawImage(H,l.x-l.width/2,l.y-l.height/2,l.width,l.height)));n.beginPath();n.rect(l.x-l.width/2,l.y-l.height/2,l.width,l.height);l._event&&R(s[p],
n,l);l._transformed&&n.restore();x=K(s[p]);n.closePath();n.stroke();pa(n,x,l);ha(n,x,l);l.load&&l.load.call(k,m);l.layer&&l._next&&d(k).drawLayers({clear:G,resetFire:w,index:l._next})}}var s=this,t,u,n,x,l=new I(m),H,y;t=l.source;y=t.getContext;t.src||y?H=t:t&&(L.source===t?H=L._source:(H=new na,H.src=t,L.source=t,L._source=H));for(u=0;u<s.length;u+=1)if(t=s[u],n=F(s[u]))m=N(s[u],l,m,p),l.visible&&H&&(H.complete||y?k(t,u,n)():(d(H).bind("load",k(t,u,n)),H.src=H.src));return s};d.fn.createPattern=
d.fn.pattern=function(p){function m(){n=s.createPattern(u,t.repeat);t.load&&t.load.call(k[0],n)}var k=this,s,t=new I(p),u,n,x;(s=F(k[0]))?(x=t.source,ba(x)?(u=d("<canvas />")[0],u.width=t.width,u.height=t.height,p=F(u),x.call(u,p),m()):(p=x.getContext,x.src||p?u=x:(u=new na,u.src=x),u.complete||p?m():(d(u).bind("load",m),u.src=u.src))):n=f;return n};d.fn.createGradient=d.fn.gradient=function(d){var m;d=new I(d);var k=[],s,t,u,n,x,l,w;if(m=F(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||
0;m=d.r1!==f||d.r2!==f?m.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):m.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(n=1;d["c"+n]!==y;n+=1)d["s"+n]!==y?k.push(d["s"+n]):k.push(f);s=k.length;k[0]===f&&(k[0]=0);k[s-1]===f&&(k[s-1]=1);for(n=0;n<s;n+=1){if(k[n]!==f){l=1;w=0;t=k[n];for(x=n+1;x<s;x+=1)if(k[x]!==f){u=k[x];break}else l+=1;t>u&&(k[x]=k[n])}else k[n]===f&&(w+=1,k[n]=t+w*((u-t)/l));m.addColorStop(k[n],d["c"+(n+1)])}}else m=f;return m};d.fn.setPixels=function m(d){var s,t,u,n=new I(d),
x={},l,w,y,G;for(t=0;t<this.length;t+=1)if(s=this[t],u=F(s)){d=N(s,n,d,m);P(u,n,n.width,n.height);if(n.width===f||n.height===f)n.width=s.width,n.height=s.height,n.x=n.width/2,n.y=n.height/2;if(0!==n.width&&0!==n.height){l=u.getImageData(n.x-n.width/2,n.y-n.height/2,n.width,n.height);w=l.data;G=w.length;x=[];if(n.each)for(y=0;y<G;y+=4)x.r=w[y],x.g=w[y+1],x.b=w[y+2],x.a=w[y+3],n.each.call(s,x),w[y]=x.r,w[y+1]=x.g,w[y+2]=x.b,w[y+3]=x.a;u.putImageData(l,n.x-n.width/2,n.y-n.height/2);u.restore()}}return this};
d.fn.getCanvasImage=function(d,k){var s=this[0];k===y&&(k=1);return s&&s.toDataURL?s.toDataURL("image/"+d,k):f};d.support.canvas=d("<canvas />")[0].getContext!==y;O.defaults=da;O._detectEvents=R;O.closePath=T;d.jCanvas=O})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
